<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BarberX â€“ Randevu Sistemi</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --gold: #c9a84c;
  --gold-light: #f0d98a;
  --gold-pale: #fdf8ec;
  --black: #0a0a0a;
  --dark: #1a1a1a;
  --gray: #6b7280;
  --gray-light: #f5f5f5;
  --white: #ffffff;
  --success: #16a34a;
  --danger: #dc2626;
  --warning: #d97706;
  --shadow: 0 4px 24px rgba(0,0,0,0.08);
  --shadow-lg: 0 12px 48px rgba(0,0,0,0.12);
  --radius: 16px;
  --radius-sm: 10px;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{font-family:'DM Sans',sans-serif;background:var(--white);color:var(--dark);min-height:100vh;overflow-x:hidden}
.hidden{display:none!important}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:10px 20px;border:none;border-radius:var(--radius-sm);font-family:'DM Sans',sans-serif;font-size:.9rem;font-weight:600;cursor:pointer;transition:all .2s ease;text-decoration:none;white-space:nowrap}
.btn-primary{background:var(--black);color:var(--white)}
.btn-primary:hover{background:var(--dark);transform:translateY(-1px);box-shadow:0 6px 20px rgba(0,0,0,.25)}
.btn-gold{background:var(--gold);color:var(--white)}
.btn-gold:hover{background:#b8933e;transform:translateY(-1px)}
.btn-success{background:var(--success);color:var(--white)}
.btn-success:hover{background:#15803d}
.btn-danger{background:var(--danger);color:var(--white)}
.btn-danger:hover{background:#b91c1c}
.btn-warning{background:var(--warning);color:var(--white)}
.btn-warning:hover{background:#b45309}
.btn-ghost{background:transparent;color:var(--gray);border:1.5px solid #e5e7eb}
.btn-ghost:hover{background:var(--gray-light);color:var(--dark)}
.btn-sm{padding:6px 14px;font-size:.8rem}
.btn-lg{padding:14px 32px;font-size:1rem}
.btn-full{width:100%}
.input-group{display:flex;flex-direction:column;gap:6px}
.label{font-size:.85rem;font-weight:600;color:var(--dark)}
.input,.select{width:100%;padding:12px 16px;border:1.5px solid #e5e7eb;border-radius:var(--radius-sm);font-family:'DM Sans',sans-serif;font-size:.9rem;color:var(--dark);background:var(--white);transition:border-color .2s ease;outline:none}
.input:focus,.select:focus{border-color:var(--gold)}
.input::placeholder{color:#9ca3af}
.card{background:var(--white);border-radius:var(--radius);box-shadow:var(--shadow);padding:24px;border:1px solid #f0f0f0}
.card-header{margin-bottom:20px;padding-bottom:16px;border-bottom:1px solid #f0f0f0}
.card-title{font-family:'Playfair Display',serif;font-size:1.2rem;font-weight:700;color:var(--dark)}
.badge{display:inline-flex;align-items:center;padding:3px 10px;border-radius:20px;font-size:.75rem;font-weight:600;gap:4px}
.badge-pending{background:#fef3c7;color:#92400e}
.badge-approved{background:#d1fae5;color:#065f46}
.badge-rejected{background:#fee2e2;color:#991b1b}
.badge-cancelled{background:#f3f4f6;color:#6b7280}
.alert{padding:14px 18px;border-radius:var(--radius-sm);font-size:.9rem;font-weight:500;margin:12px 0}
.alert-success{background:#d1fae5;color:#065f46;border:1px solid #a7f3d0}
.alert-danger{background:#fee2e2;color:#991b1b;border:1px solid #fca5a5}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:1000;padding:16px;animation:fadeIn .2s ease}
.modal{background:var(--white);border-radius:var(--radius);padding:32px;width:100%;max-width:480px;box-shadow:var(--shadow-lg);max-height:90vh;overflow-y:auto;animation:slideUp .3s ease}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}
.modal-title{font-family:'Playfair Display',serif;font-size:1.3rem;font-weight:700}
.modal-close{width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:50%;border:none;background:var(--gray-light);cursor:pointer;font-size:1.2rem;color:var(--gray);transition:all .2s}
.modal-close:hover{background:#e5e7eb}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes slideUp{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}

/* ADMIN */
#admin-panel{min-height:100vh;background:#f8f8f8}
#admin-login{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#0a0a0a 0%,#1a1a1a 50%,#2d2416 100%);padding:16px}
.admin-login-card{background:var(--white);border-radius:24px;padding:48px;width:100%;max-width:420px;box-shadow:0 24px 64px rgba(0,0,0,.4);text-align:center}
.admin-logo{width:72px;height:72px;background:var(--black);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 24px;font-size:2rem}
.admin-login-title{font-family:'Playfair Display',serif;font-size:1.8rem;font-weight:900;color:var(--dark);margin-bottom:4px}
.admin-login-sub{color:var(--gray);font-size:.9rem;margin-bottom:32px}
#admin-dashboard{display:flex;min-height:100vh}
.admin-sidebar{width:260px;background:var(--black);padding:24px 0;display:flex;flex-direction:column;flex-shrink:0;position:sticky;top:0;height:100vh;overflow-y:auto}
.admin-brand{padding:0 24px 24px;border-bottom:1px solid rgba(255,255,255,.1);margin-bottom:16px}
.admin-brand-name{font-family:'Playfair Display',serif;font-size:1.5rem;font-weight:900;color:var(--white)}
.admin-brand-sub{font-size:.75rem;color:var(--gold);letter-spacing:.1em;text-transform:uppercase}
.admin-nav{flex:1;padding:0 12px}
.admin-nav-item{display:flex;align-items:center;gap:12px;padding:12px 16px;border-radius:var(--radius-sm);color:rgba(255,255,255,.6);font-weight:500;font-size:.9rem;cursor:pointer;transition:all .2s ease;margin-bottom:4px;border:none;background:transparent;width:100%;text-align:left}
.admin-nav-item:hover{background:rgba(255,255,255,.1);color:var(--white)}
.admin-nav-item.active{background:var(--gold);color:var(--white)}
.admin-logout{padding:12px 24px;border-top:1px solid rgba(255,255,255,.1)}
.admin-main{flex:1;padding:32px;overflow-y:auto;max-width:calc(100vw - 260px)}
.admin-page-title{font-family:'Playfair Display',serif;font-size:1.8rem;font-weight:900;color:var(--dark);margin-bottom:8px}
.admin-page-sub{color:var(--gray);font-size:.9rem;margin-bottom:28px}
.appointment-table{width:100%;border-collapse:collapse;font-size:.875rem}
.appointment-table th{text-align:left;padding:12px 16px;background:var(--gray-light);color:var(--gray);font-weight:600;font-size:.8rem;text-transform:uppercase;letter-spacing:.05em}
.appointment-table th:first-child{border-radius:8px 0 0 8px}
.appointment-table th:last-child{border-radius:0 8px 8px 0}
.appointment-table td{padding:14px 16px;border-bottom:1px solid #f0f0f0;vertical-align:middle}
.appointment-table tr:last-child td{border-bottom:none}
.appointment-table tbody tr:hover{background:#fafafa}
.calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px}
.calendar-header-cell{text-align:center;font-size:.75rem;font-weight:700;color:var(--gray);padding:8px 0;text-transform:uppercase}
.calendar-day{aspect-ratio:1;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:6px;border-radius:8px;cursor:pointer;transition:all .2s;font-size:.85rem;font-weight:500;border:1.5px solid transparent}
.calendar-day:hover{background:var(--gray-light)}
.calendar-day.today{border-color:var(--gold);background:var(--gold-pale)}
.calendar-day.has-appointments{border-color:#e5e7eb}
.calendar-day.other-month{opacity:.3}
.calendar-day .day-num{font-weight:700;line-height:1}
.calendar-day .apt-dots{display:flex;gap:2px;margin-top:4px;flex-wrap:wrap;justify-content:center}
.apt-dot{width:6px;height:6px;border-radius:50%}
.dot-pending{background:var(--warning)}
.dot-approved{background:var(--success)}
.dot-rejected{background:var(--danger)}
.dot-cancelled{background:var(--gray)}
.barber-card{display:flex;align-items:center;justify-content:space-between;padding:16px;background:var(--gray-light);border-radius:var(--radius-sm);margin-bottom:12px}
.barber-avatar{width:44px;height:44px;background:var(--black);border-radius:50%;display:flex;align-items:center;justify-content:center;color:var(--white);font-weight:700;font-size:1rem;flex-shrink:0}
.barber-info{flex:1;margin-left:12px}
.barber-name{font-weight:700;font-size:.95rem}
.barber-status{font-size:.8rem;color:var(--gray);margin-top:2px}
.toggle{position:relative;width:44px;height:24px;display:inline-block;cursor:pointer}
.toggle input{opacity:0;width:0;height:0}
.toggle-slider{position:absolute;inset:0;background:#d1d5db;border-radius:12px;transition:.3s}
.toggle-slider::before{content:'';position:absolute;width:18px;height:18px;left:3px;bottom:3px;background:var(--white);border-radius:50%;transition:.3s}
.toggle input:checked+.toggle-slider{background:var(--success)}
.toggle input:checked+.toggle-slider::before{transform:translateX(20px)}
.service-row{display:flex;align-items:center;justify-content:space-between;padding:16px;background:var(--gray-light);border-radius:var(--radius-sm);margin-bottom:10px}
.service-info{flex:1}
.service-name{font-weight:700;font-size:.95rem}
.service-meta{font-size:.8rem;color:var(--gray);margin-top:3px}
.service-price{font-weight:800;font-size:1.1rem;color:var(--gold);margin-right:16px}
.hours-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.day-card{background:var(--gray-light);border-radius:var(--radius-sm);padding:16px}
.day-name{font-weight:700;font-size:.9rem;margin-bottom:10px}
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:28px}
.stat-card{background:var(--white);border-radius:var(--radius);padding:20px;box-shadow:var(--shadow);border:1px solid #f0f0f0}
.stat-value{font-family:'Playfair Display',serif;font-size:2rem;font-weight:900;color:var(--dark)}
.stat-label{font-size:.8rem;color:var(--gray);font-weight:500;margin-top:4px}
.stat-accent{display:inline-block;width:4px;height:24px;border-radius:2px;margin-right:12px;vertical-align:middle}
.view-tabs{display:flex;background:var(--gray-light);border-radius:var(--radius-sm);padding:4px;gap:2px;width:fit-content}
.view-tab{padding:8px 18px;border-radius:8px;border:none;font-family:'DM Sans',sans-serif;font-weight:600;font-size:.85rem;cursor:pointer;transition:all .2s;background:transparent;color:var(--gray)}
.view-tab.active{background:var(--white);color:var(--dark);box-shadow:0 2px 8px rgba(0,0,0,.08)}
.filter-bar{display:flex;gap:8px;flex-wrap:wrap}
.filter-chip{padding:6px 14px;border-radius:20px;border:1.5px solid #e5e7eb;background:var(--white);font-size:.8rem;font-weight:600;cursor:pointer;transition:all .2s;color:var(--gray)}
.filter-chip.active{background:var(--black);color:var(--white);border-color:var(--black)}

/* CUSTOMER */
#customer-panel{min-height:100vh}
.customer-header{background:var(--black);padding:0 24px;display:flex;align-items:center;justify-content:space-between;height:64px;position:sticky;top:0;z-index:100}
.customer-brand{font-family:'Playfair Display',serif;font-size:1.5rem;font-weight:900;color:var(--white)}
.customer-brand span{color:var(--gold)}
.customer-user{display:flex;align-items:center;gap:10px;color:var(--white);font-size:.85rem}
.customer-avatar{width:36px;height:36px;background:var(--gold);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.85rem;color:var(--white)}
#customer-login{min-height:100vh;background:linear-gradient(160deg,#0a0a0a 0%,#1a1a1a 60%,#2d2416 100%);display:flex;align-items:center;justify-content:center;padding:16px}
.customer-login-card{background:var(--white);border-radius:28px;width:100%;max-width:460px;overflow:hidden;box-shadow:0 32px 80px rgba(0,0,0,.5)}
.login-hero{background:var(--black);padding:40px 32px;text-align:center;position:relative;overflow:hidden}
.login-hero::before{content:'âœ‚';font-size:120px;position:absolute;right:-20px;top:-20px;opacity:.05;transform:rotate(-15deg)}
.login-hero-title{font-family:'Playfair Display',serif;font-size:2rem;font-weight:900;color:var(--white);line-height:1.1}
.login-hero-title span{color:var(--gold)}
.login-hero-sub{color:rgba(255,255,255,.5);font-size:.9rem;margin-top:8px}
.login-form{padding:32px}
.customer-main{padding:24px;max-width:800px;margin:0 auto}
.step-indicator{display:flex;align-items:center;margin-bottom:28px;overflow-x:auto;padding-bottom:4px}
.step{display:flex;align-items:center;gap:8px;flex-shrink:0}
.step-num{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.85rem;border:2px solid #e5e7eb;color:var(--gray);background:var(--white);transition:all .3s}
.step.active .step-num{background:var(--black);border-color:var(--black);color:var(--white)}
.step.done .step-num{background:var(--success);border-color:var(--success);color:var(--white)}
.step-label{font-size:.8rem;font-weight:600;color:var(--gray)}
.step.active .step-label,.step.done .step-label{color:var(--dark)}
.step-line{width:32px;height:2px;background:#e5e7eb;flex-shrink:0}
.booking-section{margin-bottom:0}
.booking-section-title{font-family:'Playfair Display',serif;font-size:1.1rem;font-weight:700;margin-bottom:16px;display:flex;align-items:center;gap:10px}
.section-num{width:28px;height:28px;background:var(--black);color:var(--white);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.8rem;font-weight:700;flex-shrink:0}
.service-select-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
.service-option{padding:16px;border:2px solid #e5e7eb;border-radius:var(--radius);cursor:pointer;transition:all .2s;background:var(--white)}
.service-option:hover{border-color:var(--gold);box-shadow:0 4px 12px rgba(201,168,76,.15)}
.service-option.selected{border-color:var(--black);background:var(--black);color:var(--white)}
.service-option.selected .so-price{color:var(--gold)}
.service-option.selected .so-meta{color:rgba(255,255,255,.6)}
.so-name{font-weight:700;font-size:.9rem;margin-bottom:6px}
.so-price{font-weight:800;font-size:1.1rem;color:var(--gold)}
.so-meta{font-size:.75rem;color:var(--gray);margin-top:4px}
.time-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.time-slot{padding:10px;text-align:center;border:2px solid #e5e7eb;border-radius:10px;cursor:pointer;font-size:.85rem;font-weight:600;transition:all .2s;background:var(--white);color:var(--dark)}
.time-slot:hover:not(.disabled){border-color:var(--gold)}
.time-slot.selected{background:var(--black);border-color:var(--black);color:var(--white)}
.time-slot.disabled{background:var(--gray-light);color:#d1d5db;cursor:not-allowed;border-color:#f0f0f0}
.my-apt-card{border:1.5px solid #e5e7eb;border-radius:var(--radius);overflow:hidden;margin-bottom:12px;transition:all .2s}
.my-apt-card:hover{box-shadow:var(--shadow)}
.my-apt-header{padding:16px;background:var(--gray-light);display:flex;justify-content:space-between;align-items:center}
.my-apt-date{font-weight:700;font-size:.9rem}
.my-apt-body{padding:16px}
.my-apt-detail{display:flex;gap:8px;margin-bottom:8px;font-size:.875rem}
.my-apt-icon{color:var(--gray);width:20px}
.my-apt-actions{display:flex;gap:8px;padding:12px 16px;border-top:1px solid #f0f0f0;background:#fafafa}
.main-nav{position:fixed;bottom:0;left:0;right:0;background:var(--white);border-top:1px solid #f0f0f0;display:flex;justify-content:space-around;padding:8px 0 12px;z-index:50;box-shadow:0 -4px 20px rgba(0,0,0,.06)}
.nav-item{display:flex;flex-direction:column;align-items:center;gap:3px;padding:4px 16px;cursor:pointer;border:none;background:transparent;color:var(--gray);font-family:'DM Sans',sans-serif;font-size:.7rem;font-weight:600;transition:color .2s}
.nav-item.active{color:var(--black)}
.nav-item .nav-icon{font-size:1.3rem}
.gold-line{height:3px;background:linear-gradient(to right,var(--gold),var(--gold-light),var(--gold));border-radius:2px}
.empty-state{text-align:center;padding:48px 24px;color:var(--gray)}
.empty-state-icon{font-size:3rem;margin-bottom:12px;opacity:.4}

/* TV */
#tv-panel{min-height:100vh;background:#080808;color:var(--white);padding:32px 40px 100px;overflow:hidden}
.tv-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:24px;border-bottom:1px solid rgba(201,168,76,.3);padding-bottom:20px}
.tv-brand{font-family:'Playfair Display',serif;font-size:2.5rem;font-weight:900;color:var(--white)}
.tv-brand span{color:var(--gold)}
.tv-date-time{text-align:right}
.tv-time{font-family:'Playfair Display',serif;font-size:3.5rem;font-weight:900;color:var(--gold);line-height:1}
.tv-date{color:rgba(255,255,255,.5);font-size:.95rem;margin-top:4px}
.tv-refresh-info{font-size:.75rem;color:rgba(255,255,255,.3);margin-top:4px}
.tv-stats-bar{display:flex;gap:14px;margin-bottom:22px;flex-wrap:wrap;align-items:center}
.tv-stat{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:12px 20px;display:flex;align-items:center;gap:12px}
.tv-stat-num{font-family:'Playfair Display',serif;font-size:1.9rem;font-weight:900;color:var(--gold);line-height:1}
.tv-stat-lbl{font-size:.72rem;color:rgba(255,255,255,.5);font-weight:600;line-height:1.4}
.tv-countdown{background:rgba(201,168,76,.1);border:1px solid rgba(201,168,76,.35);border-radius:12px;padding:12px 20px;display:flex;align-items:center;gap:12px;margin-left:auto}
.tv-countdown-lbl{font-size:.72rem;color:var(--gold);font-weight:600;line-height:1.4}
.tv-countdown-val{font-family:'Playfair Display',serif;font-size:1.9rem;font-weight:900;color:var(--gold);line-height:1}
.tv-section-title{font-family:'Playfair Display',serif;font-size:1.4rem;font-weight:700;color:var(--gold);margin-bottom:14px;display:flex;align-items:center;gap:12px}
.tv-section-title::after{content:'';flex:1;height:1px;background:rgba(201,168,76,.2)}
.tv-barber-columns{display:grid;gap:16px;margin-bottom:20px}
.tv-barber-col{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:14px;min-width:0}
.tv-barber-col-header{display:flex;align-items:center;gap:10px;margin-bottom:12px;padding-bottom:10px;border-bottom:1px solid rgba(255,255,255,.07)}
.tv-barber-col-avatar{width:38px;height:38px;background:var(--gold);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:900;font-size:.95rem;color:var(--black);flex-shrink:0}
.tv-barber-col-name{font-family:'Playfair Display',serif;font-size:1rem;font-weight:700;color:var(--white)}
.tv-barber-col-count{font-size:.72rem;color:rgba(255,255,255,.4);margin-top:1px}
.tv-apt-card{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:10px;padding:14px;margin-bottom:8px;position:relative;overflow:hidden;transition:all .3s}
.tv-apt-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px}
.tv-apt-card.status-approved{border-color:rgba(22,163,74,.35)}
.tv-apt-card.status-approved::before{background:var(--success)}
.tv-apt-card.new-arrival{animation:blink-gold 5s ease-in-out}
.tv-apt-card.new-arrival .tv-apt-name{animation:blink-name-tv .9s ease-in-out 6}
@keyframes blink-gold{
  0%,100%{box-shadow:none;border-color:rgba(22,163,74,.35)}
  10%,30%,50%,70%,90%{box-shadow:0 0 28px rgba(201,168,76,.95),0 0 56px rgba(201,168,76,.45);border-color:var(--gold)}
  20%,40%,60%,80%{box-shadow:none;border-color:rgba(22,163,74,.35)}
}
@keyframes blink-name-tv{0%,100%{opacity:1}50%{opacity:.1}}
.tv-next-card{border:2px solid var(--gold)!important;box-shadow:0 4px 20px rgba(201,168,76,.3)!important}
.tv-next-label{background:var(--gold);color:var(--black);font-size:.7rem;font-weight:900;padding:4px 10px;border-radius:6px;margin-bottom:8px;text-transform:uppercase;letter-spacing:.08em;display:inline-block}
.tv-wait-badge{background:rgba(37,99,235,.15);color:#93c5fd;font-size:.68rem;font-weight:700;padding:3px 8px;border-radius:12px}
.tv-apt-time{font-family:'Playfair Display',serif;font-size:1.6rem;font-weight:900;color:var(--white);margin-bottom:4px}
.tv-apt-name{font-size:1rem;font-weight:700;color:var(--white);margin-bottom:3px}
.tv-apt-service{font-size:.8rem;color:rgba(255,255,255,.5);margin-bottom:6px}
.tv-status-badge{display:inline-flex;align-items:center;gap:5px;padding:3px 9px;border-radius:20px;font-size:.72rem;font-weight:700}
.tv-status-badge.approved{background:rgba(22,163,74,.2);color:#6ee7b7}
.tv-wait-badge{display:inline-flex;align-items:center;gap:4px;background:rgba(59,130,246,.2);color:#93c5fd;font-size:.7rem;font-weight:700;padding:3px 9px;border-radius:20px}
.tv-new-badge{background:var(--gold);color:var(--black);font-size:.6rem;font-weight:900;padding:2px 7px;border-radius:8px;letter-spacing:.05em;text-transform:uppercase;margin-left:6px;vertical-align:middle}
.tv-empty-col{text-align:center;padding:24px 0;color:rgba(255,255,255,.25);font-size:.85rem}
.tv-qr-panel{background:rgba(255,255,255,.04);border:1px solid rgba(201,168,76,.2);border-radius:14px;padding:18px 22px;margin-bottom:18px;display:flex;align-items:center;gap:20px;flex-wrap:wrap}
.tv-qr-box{width:90px;height:90px;background:var(--white);border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0;overflow:hidden;padding:6px}
.tv-qr-box canvas{display:block}
.tv-qr-title{font-family:'Playfair Display',serif;font-size:1.1rem;font-weight:700;color:var(--gold);margin-bottom:5px}
.tv-qr-desc{font-size:.8rem;color:rgba(255,255,255,.5);line-height:1.5}
.tv-qr-url{font-size:.75rem;color:rgba(201,168,76,.8);margin-top:5px;font-weight:600}
.tv-cancelled-bar{position:fixed;bottom:44px;left:0;right:0;background:rgba(180,20,20,.2);border-top:1px solid rgba(220,38,38,.3);height:34px;display:none;align-items:center;overflow:hidden}
.tv-cancelled-bar.has-cancelled{display:flex}
.tv-cancelled-label{background:var(--danger);color:var(--white);font-size:.7rem;font-weight:900;padding:0 12px;height:100%;display:flex;align-items:center;white-space:nowrap;letter-spacing:.06em;flex-shrink:0}
.tv-cancelled-scroll{overflow:hidden;flex:1;height:100%;display:flex;align-items:center}
.tv-cancelled-text{white-space:nowrap;animation:marquee 18s linear infinite;color:rgba(255,140,140,.9);font-size:.78rem;font-weight:600;padding:0 16px;display:inline-block}
.tv-marquee-bar{position:fixed;bottom:0;left:0;right:0;height:44px;background:var(--gold);display:flex;align-items:center;overflow:hidden}
.tv-marquee-content{white-space:nowrap;animation:marquee 35s linear infinite;padding:0 40px;font-weight:700;color:var(--black);font-size:.9rem;display:inline-block}
@keyframes marquee{from{transform:translateX(100vw)}to{transform:translateX(-100%)}}

/* RESPONSIVE */
@media(max-width:900px){
  .admin-sidebar{width:200px}
  .admin-main{max-width:calc(100vw - 200px)}
  .stats-grid{grid-template-columns:repeat(2,1fr)}
  .tv-barber-columns{grid-template-columns:repeat(2,1fr)!important}
}
@media(max-width:768px){
  #admin-dashboard{flex-direction:column}
  .admin-sidebar{width:100%;height:auto;position:static;flex-direction:row;overflow-x:auto;padding:12px}
  .admin-brand{display:none}
  .admin-nav{display:flex;flex-direction:row;padding:0;gap:4px}
  .admin-logout{padding:0;border:none}
  .admin-main{max-width:100%;padding:16px}
  .stats-grid{grid-template-columns:repeat(2,1fr)}
  .hours-grid{grid-template-columns:1fr}
  .time-grid{grid-template-columns:repeat(3,1fr)}
  .service-select-grid{grid-template-columns:1fr}
  .tv-barber-columns{grid-template-columns:1fr!important}
  #tv-panel{padding:16px 16px 100px}
  .tv-header{flex-direction:column;gap:12px}
  .tv-brand{font-size:1.8rem}
  .tv-time{font-size:2.5rem}
  .tv-stats-bar{gap:8px}
  .tv-stat{padding:10px 14px}
  .tv-stat-num{font-size:1.5rem}
  .tv-countdown{margin-left:0}
  .tv-qr-panel{padding:14px}
  .tv-qr-box{width:70px;height:70px}
}
@media(max-width:480px){
  .stats-grid{grid-template-columns:1fr 1fr}
  .calendar-header-cell{font-size:.65rem}
  .calendar-day{font-size:.75rem}
  .customer-main{padding:16px}
  .step-label{display:none}
  .modal{padding:20px}
  .time-grid{grid-template-columns:repeat(3,1fr)}
  .service-select-grid{grid-template-columns:1fr}
}
</style>
</head>
<body>

<!-- ADMIN PANEL -->
<div id="admin-panel" class="hidden">
  <div id="admin-login">
    <div class="admin-login-card">
      <div class="admin-logo">âœ‚</div>
      <h1 class="admin-login-title">YÃ¶netim Paneli</h1>
      <p class="admin-login-sub">LÃ¼tfen ÅŸifrenizi girerek giriÅŸ yapÄ±n</p>
      <div class="input-group" style="margin-bottom:16px;text-align:left;">
        <label class="label">YÃ¶netici Åifresi</label>
        <input type="password" class="input" id="admin-password" placeholder="Åifrenizi girin" onkeypress="if(event.key==='Enter')adminLogin()">
      </div>
      <div id="admin-login-error" class="alert alert-danger hidden">HatalÄ± ÅŸifre. LÃ¼tfen tekrar deneyin.</div>
      <button class="btn btn-primary btn-full btn-lg" onclick="adminLogin()">GiriÅŸ Yap</button>
    </div>
  </div>

  <div id="admin-dashboard" class="hidden">
    <aside class="admin-sidebar" id="admin-sidebar">
      <div class="admin-brand">
        <div class="admin-brand-name">BarberX</div>
        <div class="admin-brand-sub">Admin Paneli</div>
      </div>
      <nav class="admin-nav">
        <button class="admin-nav-item active" onclick="showAdminSection('dashboard')"><span>ğŸ“Š</span> Dashboard</button>
        <button class="admin-nav-item" onclick="showAdminSection('calendar')"><span>ğŸ“…</span> Randevu Takvimi</button>
        <button class="admin-nav-item" onclick="showAdminSection('barbers')"><span>âœ‚</span> Berber YÃ¶netimi</button>
        <button class="admin-nav-item" onclick="showAdminSection('services')"><span>ğŸ“‹</span> Hizmet KataloÄŸu</button>
        <button class="admin-nav-item" onclick="showAdminSection('hours')"><span>ğŸ•</span> Ã‡alÄ±ÅŸma Saatleri</button>
      </nav>
      <div class="admin-logout">
        <button class="btn btn-ghost btn-full btn-sm" onclick="adminLogout()" style="color:rgba(255,255,255,.5);border-color:rgba(255,255,255,.15)">Ã‡Ä±kÄ±ÅŸ Yap</button>
      </div>
    </aside>

    <main class="admin-main">
      <!-- Dashboard -->
      <div id="section-dashboard">
        <h1 class="admin-page-title">Dashboard</h1>
        <p class="admin-page-sub">Genel bakÄ±ÅŸ ve istatistikler</p>
        <div class="stats-grid" id="admin-stats"></div>
        <div class="card">
          <div class="card-header"><div class="card-title">BugÃ¼nkÃ¼ Randevular</div></div>
          <div id="today-apts-list"></div>
        </div>
      </div>

      <!-- Calendar -->
      <div id="section-calendar" class="hidden">
        <h1 class="admin-page-title">Randevu Takvimi</h1>
        <p class="admin-page-sub">TÃ¼m randevularÄ± yÃ¶netin</p>
        <div class="card" style="margin-bottom:20px">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:12px">
            <div class="view-tabs">
              <button class="view-tab active" id="tab-calendar-btn" onclick="switchCalView('calendar')">ğŸ“… Takvim</button>
              <button class="view-tab" id="tab-list-btn" onclick="switchCalView('list')">ğŸ“‹ Liste</button>
            </div>
            <div class="filter-bar">
              <button class="filter-chip active" onclick="setFilter('all',this)">TÃ¼mÃ¼</button>
              <button class="filter-chip" onclick="setFilter('Bekliyor',this)">Bekliyor</button>
              <button class="filter-chip" onclick="setFilter('OnaylandÄ±',this)">OnaylandÄ±</button>
              <button class="filter-chip" onclick="setFilter('Reddedildi',this)">Reddedildi</button>
              <button class="filter-chip" onclick="setFilter('Ä°ptal',this)">Ä°ptal</button>
            </div>
          </div>
          <div id="calendar-view-wrap">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
              <button class="btn btn-ghost btn-sm" onclick="prevMonth()">â—€ Ã–nceki</button>
              <strong id="cal-month-label" style="font-size:1.1rem"></strong>
              <button class="btn btn-ghost btn-sm" onclick="nextMonth()">Sonraki â–¶</button>
            </div>
            <div class="calendar-grid" id="cal-headers"></div>
            <div class="calendar-grid" id="cal-days" style="margin-top:4px"></div>
          </div>
          <div id="list-view-wrap" class="hidden" style="overflow-x:auto">
            <table class="appointment-table">
              <thead><tr><th>MÃ¼ÅŸteri</th><th>Berber</th><th>Hizmet</th><th>Tarih &amp; Saat</th><th>Durum</th><th>Ä°ÅŸlem</th></tr></thead>
              <tbody id="apt-list-tbody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Barbers -->
      <div id="section-barbers" class="hidden">
        <h1 class="admin-page-title">Berber YÃ¶netimi</h1>
        <p class="admin-page-sub">Berberleri ekleyin ve yÃ¶netin</p>
        <div class="card" style="margin-bottom:20px">
          <div class="card-header"><div class="card-title">Yeni Berber Ekle</div></div>
          <div style="display:flex;gap:12px;flex-wrap:wrap">
            <input class="input" id="new-barber-name" placeholder="Berber adÄ± girin" style="flex:1;min-width:200px">
            <button class="btn btn-primary" onclick="addBarber()">+ Ekle</button>
          </div>
        </div>
        <div class="card">
          <div class="card-header"><div class="card-title">Berber Listesi</div></div>
          <div id="barber-list"></div>
        </div>
      </div>

      <!-- Services -->
      <div id="section-services" class="hidden">
        <h1 class="admin-page-title">Hizmet KataloÄŸu</h1>
        <p class="admin-page-sub">Sunulan hizmetleri yÃ¶netin</p>
        <div class="card" style="margin-bottom:20px">
          <div class="card-header"><div class="card-title">Yeni Hizmet Ekle</div></div>
          <div style="display:grid;grid-template-columns:2fr 1fr 1fr auto;gap:12px;align-items:end">
            <div class="input-group"><label class="label">Hizmet AdÄ±</label><input class="input" id="new-svc-name" placeholder="Ã–rn: SaÃ§ Kesimi"></div>
            <div class="input-group"><label class="label">Fiyat (â‚º)</label><input class="input" id="new-svc-price" type="number" placeholder="250"></div>
            <div class="input-group"><label class="label">SÃ¼re (dk)</label><input class="input" id="new-svc-dur" type="number" placeholder="30"></div>
            <button class="btn btn-primary" onclick="addService()" style="height:46px">+ Ekle</button>
          </div>
        </div>
        <div class="card">
          <div class="card-header"><div class="card-title">Hizmet Listesi</div></div>
          <div id="service-list"></div>
        </div>
      </div>

      <!-- Hours -->
      <div id="section-hours" class="hidden">
        <h1 class="admin-page-title">Ã‡alÄ±ÅŸma Saatleri</h1>
        <p class="admin-page-sub">GÃ¼nlÃ¼k Ã§alÄ±ÅŸma saatlerini ve tatil gÃ¼nlerini ayarlayÄ±n</p>
        <div class="card" style="margin-bottom:20px">
          <div class="card-header"><div class="card-title">GÃ¼nlÃ¼k Ã‡alÄ±ÅŸma Saatleri</div></div>
          <div class="hours-grid" id="hours-grid"></div>
        </div>
        <div class="card">
          <div class="card-header"><div class="card-title">Tatil GÃ¼nleri</div></div>
          <div style="display:flex;gap:12px;margin-bottom:16px;flex-wrap:wrap">
            <input class="input" id="holiday-date" type="date" style="flex:1;min-width:180px">
            <input class="input" id="holiday-note" placeholder="AÃ§Ä±klama (opsiyonel)" style="flex:1;min-width:200px">
            <button class="btn btn-primary" onclick="addHoliday()">Tatil Ekle</button>
          </div>
          <div id="holiday-list"></div>
        </div>
      </div>
    </main>
  </div>
</div>

<!-- CUSTOMER PANEL -->
<div id="customer-panel" class="hidden">
  <div id="customer-login">
    <div class="customer-login-card">
      <div class="login-hero">
        <div class="login-hero-title">Barber<span>X</span></div>
        <div class="login-hero-sub">Profesyonel berber randevu sistemi</div>
        <div id="login-barbers" style="margin-top:16px;display:flex;gap:12px;justify-content:center;flex-wrap:wrap">
          <!-- Berberler dinamik yÃ¼klenecek -->
        </div>
      </div>
      <div class="login-form">
        <div style="font-weight:700;font-size:1rem;margin-bottom:20px">Randevu almak iÃ§in bilgilerinizi girin</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px">
          <div class="input-group"><label class="label">Ad</label><input class="input" id="cust-name" placeholder="AdÄ±nÄ±z"></div>
          <div class="input-group"><label class="label">Soyad</label><input class="input" id="cust-surname" placeholder="SoyadÄ±nÄ±z"></div>
        </div>
        <div class="input-group" style="margin-bottom:16px">
          <label class="label">Telefon NumarasÄ±</label>
          <input class="input" id="cust-phone" placeholder="05XX XXX XX XX" type="tel">
        </div>
        <div id="cust-login-error" class="alert alert-danger hidden">LÃ¼tfen tÃ¼m alanlarÄ± doldurun.</div>
        <button class="btn btn-primary btn-full btn-lg" onclick="customerLogin()">Devam Et â†’</button>
        <p style="text-align:center;font-size:.8rem;color:var(--gray);margin-top:16px">Randevu alarak <strong>hizmet ÅŸartlarÄ±mÄ±zÄ±</strong> kabul etmiÅŸ olursunuz.</p>
      </div>
    </div>
  </div>

  <div id="customer-dashboard" class="hidden">
    <header class="customer-header">
      <div class="customer-brand">Barber<span>X</span></div>
      <div class="customer-user">
        <div>
          <div id="cust-header-name" style="font-weight:600"></div>
          <div id="cust-header-phone" style="font-size:.75rem;color:rgba(255,255,255,.5)"></div>
        </div>
        <div class="customer-avatar" id="cust-avatar"></div>
      </div>
    </header>
    <nav class="main-nav">
      <button class="nav-item active" id="nav-book" onclick="showCustTab('book')"><span class="nav-icon">ğŸ“…</span>Randevu Al</button>
      <button class="nav-item" id="nav-myapts" onclick="showCustTab('myapts')"><span class="nav-icon">ğŸ“‹</span>RandevularÄ±m</button>
      <button class="nav-item" id="nav-qrcard" onclick="showCustTab('qrcard')"><span class="nav-icon">ğŸªª</span>QR KartÄ±m</button>
      <button class="nav-item" onclick="customerLogout()"><span class="nav-icon">ğŸšª</span>Ã‡Ä±kÄ±ÅŸ</button>
    </nav>

    <!-- Book Tab -->
    <div id="cust-tab-book" class="customer-main" style="padding-bottom:90px">
      <div id="booking-success" class="alert alert-success hidden">âœ… Randevunuz baÅŸarÄ±yla oluÅŸturuldu. Onay bekleniyor.</div>
      <div class="step-indicator" style="margin-bottom:24px">
        <div class="step active" id="step-1"><div class="step-num">1</div><div class="step-label">Berber</div></div>
        <div class="step-line" id="sl-1"></div>
        <div class="step" id="step-2"><div class="step-num">2</div><div class="step-label">Hizmet</div></div>
        <div class="step-line" id="sl-2"></div>
        <div class="step" id="step-3"><div class="step-num">3</div><div class="step-label">Tarih &amp; Saat</div></div>
        <div class="step-line" id="sl-3"></div>
        <div class="step" id="step-4"><div class="step-num">4</div><div class="step-label">Onayla</div></div>
      </div>
      <div class="card booking-section">
        <div class="booking-section-title"><div class="section-num">1</div>Berber SeÃ§in</div>
        <div class="input-group">
          <label class="label">Berber</label>
          <select class="select" id="book-barber" onchange="onBarberChange()"><option value="">â€” Berber seÃ§in â€”</option></select>
        </div>
      </div>
      <div class="card booking-section" style="margin-top:16px">
        <div class="booking-section-title"><div class="section-num">2</div>Hizmet SeÃ§in</div>
        <div class="service-select-grid" id="book-services"></div>
      </div>
      <div class="card booking-section" style="margin-top:16px">
        <div class="booking-section-title"><div class="section-num">3</div>Tarih &amp; Saat SeÃ§in</div>
        <div class="input-group" style="margin-bottom:16px">
          <label class="label">Tarih</label>
          <input class="input" type="date" id="book-date" onchange="loadSlots()">
        </div>
        <div class="label" style="margin-bottom:10px">MÃ¼sait Saatler</div>
        <div class="time-grid" id="book-times"></div>
      </div>
      <div class="card booking-section" style="margin-top:16px">
        <div class="booking-section-title"><div class="section-num">4</div>Randevuyu Onayla</div>
        <div id="booking-summary" style="background:var(--gray-light);border-radius:var(--radius-sm);padding:20px;margin-bottom:20px"></div>
        <button class="btn btn-primary btn-full btn-lg" onclick="createAppointment()">ğŸ“… Randevu OluÅŸtur</button>
      </div>
    </div>

    <!-- My Apts Tab -->
    <div id="cust-tab-myapts" class="customer-main hidden" style="padding-bottom:90px">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:12px">
        <div>
          <h2 style="font-family:'Playfair Display',serif;font-size:1.4rem;font-weight:700">RandevularÄ±m</h2>
          <p style="color:var(--gray);font-size:.85rem">TÃ¼m randevu geÃ§miÅŸiniz</p>
        </div>
        <div class="view-tabs">
          <button class="view-tab active" id="myapt-upcoming-btn" onclick="filterMyApts('upcoming',this)">YaklaÅŸan</button>
          <button class="view-tab" id="myapt-past-btn" onclick="filterMyApts('past',this)">GeÃ§miÅŸ</button>
        </div>
      </div>
      <div id="my-apts-list"></div>
    </div>

    <!-- QR Card Tab -->
    <div id="cust-tab-qrcard" class="customer-main hidden" style="padding-bottom:90px">
      <div style="text-align:center;margin-bottom:24px">
        <h2 style="font-family:'Playfair Display',serif;font-size:1.4rem;font-weight:700">QR Randevu KartÄ±m</h2>
        <p style="color:var(--gray);font-size:.85rem;margin-top:4px">Bu kartÄ± gÃ¶stererek veya QR okutarak hÄ±zlÄ± randevu alÄ±n</p>
      </div>
      <div style="max-width:360px;margin:0 auto">
        <div style="background:var(--black);border-radius:24px;padding:32px;text-align:center;box-shadow:0 16px 48px rgba(0,0,0,.25);position:relative;overflow:hidden">
          <div style="position:absolute;top:-20px;right:-20px;font-size:100px;opacity:.04;transform:rotate(-15deg)">âœ‚</div>
          <div style="font-family:'Playfair Display',serif;font-size:1.5rem;font-weight:900;color:var(--white);margin-bottom:4px">Barber<span style="color:var(--gold)">X</span></div>
          <div style="font-size:.7rem;color:rgba(255,255,255,.4);letter-spacing:.12em;text-transform:uppercase;margin-bottom:24px">Randevu KartÄ±</div>
          <div style="background:var(--white);border-radius:16px;padding:16px;display:inline-block;margin-bottom:20px">
            <div id="cust-qr-container" style="width:160px;height:160px;display:flex;align-items:center;justify-content:center"></div>
          </div>
          <div style="color:var(--white);font-weight:700;font-size:1.1rem;margin-bottom:4px" id="qrcard-name"></div>
          <div style="color:var(--gold);font-size:.9rem;margin-bottom:16px" id="qrcard-phone"></div>
          <div style="height:1px;background:rgba(255,255,255,.1);margin-bottom:16px"></div>
          <div style="font-size:.75rem;color:rgba(255,255,255,.4)">QR kodu okutarak bilgileriniz otomatik doldurulur</div>
        </div>
        <div style="margin-top:16px;text-align:center">
          <button class="btn btn-ghost btn-sm" onclick="showCustTab('book')" style="gap:6px">ğŸ“… Randevu Al</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- TV PANEL -->
<div id="tv-panel" class="hidden">
  <div class="tv-header">
    <div>
      <div class="tv-brand">Barber<span>X</span></div>
      <div style="color:rgba(255,255,255,.4);font-size:.8rem;margin-top:4px">CanlÄ± Randevu EkranÄ±</div>
    </div>
    <div class="tv-date-time">
      <div class="tv-time" id="tv-clock">00:00</div>
      <div class="tv-date" id="tv-date-str"></div>
      <div class="tv-refresh-info">Her 10 saniyede bir yenileniyor</div>
    </div>
  </div>
  <div class="tv-stats-bar" id="tv-stats-bar"></div>
  <div class="tv-qr-panel">
    <div class="tv-qr-box"><canvas id="tv-qr-canvas" width="78" height="78"></canvas></div>
    <div class="tv-qr-info">
      <div class="tv-qr-title">ğŸ“± QR ile HÄ±zlÄ± Randevu</div>
      <div class="tv-qr-desc">Telefonunuzla QR kodu okutun, bilgilerinizi kaydedin.<br>Bir sonraki ziyaretinizde anÄ±nda randevu alÄ±n!</div>
      <div class="tv-qr-url" id="tv-qr-url"></div>
    </div>
  </div>
  <div class="tv-section-title">âœ… Onaylanan Randevular</div>
  <div class="tv-barber-columns" id="tv-barber-cols"></div>
  <div class="tv-cancelled-bar" id="tv-cancelled-bar">
    <div class="tv-cancelled-label">â›” Ä°PTAL EDÄ°LENLER</div>
    <div class="tv-cancelled-scroll"><div class="tv-cancelled-text" id="tv-cancelled-text"></div></div>
  </div>
  <div class="tv-marquee-bar">
    <div class="tv-marquee-content" id="tv-marquee">HoÅŸ geldiniz! Â· BarberX Randevu Sistemi Â· Profesyonel Berber Hizmetleri Â· SaÃ§ Kesimi Â· Sakal TÄ±raÅŸÄ± Â· Ã‡ocuk Kesimi</div>
  </div>
</div>

<!-- MODALS -->
<div id="modal-edit-apt" class="modal-overlay hidden">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">Randevu DÃ¼zenle</div>
      <button class="modal-close" onclick="closeModal('modal-edit-apt')">âœ•</button>
    </div>
    <div class="input-group" style="margin-bottom:14px"><label class="label">Berber</label><select class="select" id="edit-barber"></select></div>
    <div class="input-group" style="margin-bottom:14px"><label class="label">Hizmet</label><select class="select" id="edit-service"></select></div>
    <div class="input-group" style="margin-bottom:14px"><label class="label">Tarih</label><input class="input" type="date" id="edit-date" onchange="loadEditSlots()"></div>
    <div class="input-group" style="margin-bottom:20px"><label class="label">Saat</label><select class="select" id="edit-time"></select></div>
    <div style="display:flex;gap:10px">
      <button class="btn btn-ghost" onclick="closeModal('modal-edit-apt')" style="flex:1">Ä°ptal</button>
      <button class="btn btn-primary" onclick="saveEditApt()" style="flex:1">Kaydet</button>
    </div>
  </div>
</div>

<div id="modal-edit-svc" class="modal-overlay hidden">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">Hizmet DÃ¼zenle</div>
      <button class="modal-close" onclick="closeModal('modal-edit-svc')">âœ•</button>
    </div>
    <div class="input-group" style="margin-bottom:14px"><label class="label">Hizmet AdÄ±</label><input class="input" id="edit-svc-name"></div>
    <div class="input-group" style="margin-bottom:14px"><label class="label">Fiyat (â‚º)</label><input class="input" type="number" id="edit-svc-price"></div>
    <div class="input-group" style="margin-bottom:20px"><label class="label">SÃ¼re (dakika)</label><input class="input" type="number" id="edit-svc-dur"></div>
    <div style="display:flex;gap:10px">
      <button class="btn btn-ghost" onclick="closeModal('modal-edit-svc')" style="flex:1">Ä°ptal</button>
      <button class="btn btn-success" onclick="saveEditSvc()" style="flex:1">Kaydet</button>
    </div>
  </div>
</div>

<div id="modal-day" class="modal-overlay hidden">
  <div class="modal" style="max-width:560px">
    <div class="modal-header">
      <div class="modal-title" id="modal-day-title">Randevular</div>
      <button class="modal-close" onclick="closeModal('modal-day')">âœ•</button>
    </div>
    <div id="modal-day-body"></div>
  </div>
</div>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DATA
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DB={
  get(k){try{return JSON.parse(localStorage.getItem('bx_'+k))||null}catch{return null}},
  set(k,v){localStorage.setItem('bx_'+k,JSON.stringify(v))}
};

function initData(){
  if(!DB.get('barbers'))DB.set('barbers',[
    {id:1,name:'Ahmet Usta',active:true},
    {id:2,name:'Mehmet',active:true},
    {id:3,name:'Burak',active:true}
  ]);
  if(!DB.get('services'))DB.set('services',[
    {id:1,name:'SaÃ§ Kesimi',price:250,duration:30},
    {id:2,name:'Sakal TÄ±raÅŸÄ±',price:150,duration:20},
    {id:3,name:'SaÃ§ + Sakal',price:350,duration:50},
    {id:4,name:'Ã‡ocuk Kesimi',price:200,duration:25}
  ]);
  if(!DB.get('hours')){
    const days=['Pazartesi','SalÄ±','Ã‡arÅŸamba','PerÅŸembe','Cuma','Cumartesi','Pazar'],h={};
    days.forEach((d,i)=>{h[d]={open:'09:00',close:'20:00',closed:i===6}});
    DB.set('hours',h);
  }
  if(!DB.get('holidays'))DB.set('holidays',[]);
  if(!DB.get('apts')){
    const t=today(),tom=new Date(Date.now()+86400000).toISOString().split('T')[0];
    DB.set('apts',[
      {id:1,custName:'Emre YÄ±lmaz',custPhone:'05321234567',barberId:1,serviceId:1,date:t,time:'10:00',status:'Bekliyor',ts:Date.now()},
      {id:2,custName:'Zeynep Kaya',custPhone:'05457654321',barberId:2,serviceId:2,date:t,time:'11:00',status:'OnaylandÄ±',ts:Date.now()},
      {id:3,custName:'Murat Demir',custPhone:'05399876543',barberId:1,serviceId:3,date:t,time:'13:00',status:'Bekliyor',ts:Date.now()},
      {id:4,custName:'Selin Arslan',custPhone:'05501234567',barberId:3,serviceId:4,date:t,time:'14:30',status:'Ä°ptal',ts:Date.now()},
      {id:5,custName:'Kadir Åahin',custPhone:'05321112233',barberId:2,serviceId:1,date:tom,time:'09:30',status:'Bekliyor',ts:Date.now()},
      {id:6,custName:'AyÅŸe Ã‡elik',custPhone:'05449876543',barberId:1,serviceId:2,date:tom,time:'15:00',status:'OnaylandÄ±',ts:Date.now()}
    ]);
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STATE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let adminAuth=DB.get('adminAuth')===true;
let custSession=DB.get('custSession');
let calFilter='all';
let calViewType='calendar';
let calDate=new Date();
let editAptId=null,editSvcId=null;
let selService=null,selTime=null;
let myFilter='upcoming';

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// UTILS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function today(){return new Date().toISOString().split('T')[0]}
function el(id){return document.getElementById(id)}
function show(id){el(id)?.classList.remove('hidden')}
function hide(id){el(id)?.classList.add('hidden')}
function closeModal(id){hide(id)}
function formatDate(ds){
  if(!ds)return'';
  const d=new Date(ds);
  return d.toLocaleDateString('tr-TR',{day:'numeric',month:'long',year:'numeric'});
}
function statusBadge(s){
  const m={Bekliyor:'pending',OnaylandÄ±:'approved',Reddedildi:'rejected',Ä°ptal:'cancelled'};
  return`<span class="badge badge-${m[s]||'pending'}">${s}</span>`;
}
function barberName(id){return((DB.get('barbers')||[]).find(b=>b.id===id)||{name:'â€”'}).name}
function serviceName(id){return((DB.get('services')||[]).find(s=>s.id===id)||{name:'â€”'}).name}
function genSlots(open,close,dur){
  const slots=[];let[h,m]=open.split(':').map(Number);const[ch,cm]=close.split(':').map(Number);
  while(h<ch||(h===ch&&m<cm)){slots.push(`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`);m+=dur;if(m>=60){h+=Math.floor(m/60);m=m%60}}
  return slots;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ROUTER
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function route(){
  ['admin-panel','customer-panel','tv-panel'].forEach(hide);
  const h=location.hash;
  if(h==='#/admin'){
    show('admin-panel');
    if(adminAuth){show('admin-dashboard');hide('admin-login');renderDashboard()}
    else{show('admin-login');hide('admin-dashboard')}
  } else if(h==='#/display'){
    show('tv-panel');startTV();
  } else {
    show('customer-panel');
    if(custSession){show('customer-dashboard');hide('customer-login');initCustomer()}
    else{show('customer-login');hide('customer-dashboard');loadLoginBarbers()}
  }
}
window.addEventListener('hashchange',route);
window.addEventListener('load',()=>{
  initData();
  // Check for QR prefill in URL
  const params=new URLSearchParams(location.search);
  const qrRaw=params.get('qr');
  if(qrRaw){
    try{
      const d=JSON.parse(decodeURIComponent(qrRaw));
      if(d.phone&&d.name&&d.surname){
        const profiles=DB.get('profiles')||{};
        if(profiles[d.phone]){
          custSession={name:d.name,surname:d.surname,phone:d.phone,fullName:d.name+' '+d.surname};
          DB.set('custSession',custSession);
        }
      }
    }catch(e){}
  }
  route();injectRouterBar();
});

function injectRouterBar(){
  const old=el('__router');if(old)old.remove();
  const bar=document.createElement('div');bar.id='__router';
  bar.style.cssText='position:fixed;top:8px;right:8px;z-index:9999;display:flex;gap:6px';
  bar.innerHTML=`
    <a href="#/" style="padding:5px 10px;background:rgba(0,0,0,.75);color:#fff;border-radius:8px;font-size:.7rem;text-decoration:none;font-weight:700">ğŸ  MÃ¼ÅŸteri</a>
    <a href="#/admin" style="padding:5px 10px;background:rgba(201,168,76,.9);color:#fff;border-radius:8px;font-size:.7rem;text-decoration:none;font-weight:700">âš™ Admin</a>
    <a href="#/display" style="padding:5px 10px;background:rgba(0,0,0,.75);color:#fff;border-radius:8px;font-size:.7rem;text-decoration:none;font-weight:700">ğŸ“º TV</a>
  `;
  document.body.appendChild(bar);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ADMIN AUTH
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function adminLogin(){
  if(el('admin-password').value==='Berber123'){
    DB.set('adminAuth',true);adminAuth=true;
    hide('admin-login');show('admin-dashboard');renderDashboard();
  } else show('admin-login-error');
}
function adminLogout(){
  DB.set('adminAuth',false);adminAuth=false;
  show('admin-login');hide('admin-dashboard');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ADMIN SECTIONS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const adminSections=['dashboard','calendar','barbers','services','hours'];
function showAdminSection(sec){
  adminSections.forEach(s=>{hide('section-'+s)});
  show('section-'+sec);
  document.querySelectorAll('.admin-nav-item').forEach((b,i)=>{b.classList.toggle('active',adminSections[i]===sec)});
  if(sec==='dashboard')renderDashboard();
  if(sec==='calendar')renderCalendar();
  if(sec==='barbers')renderBarbers();
  if(sec==='services')renderServices();
  if(sec==='hours')renderHours();
}

// â”€ Dashboard â”€
function renderDashboard(){
  const apts=DB.get('apts')||[];
  const td=today(),todayA=apts.filter(a=>a.date===td);
  const stats=[
    {label:'Toplam Randevu',val:apts.length,color:'#c9a84c'},
    {label:'BugÃ¼nkÃ¼ Randevu',val:todayA.length,color:'#2563eb'},
    {label:'Bekleyen',val:apts.filter(a=>a.status==='Bekliyor').length,color:'#d97706'},
    {label:'Onaylanan',val:apts.filter(a=>a.status==='OnaylandÄ±').length,color:'#16a34a'}
  ];
  el('admin-stats').innerHTML=stats.map(s=>`
    <div class="stat-card">
      <div style="display:flex;align-items:center;margin-bottom:8px">
        <div class="stat-accent" style="background:${s.color}"></div>
        <span class="stat-label">${s.label}</span>
      </div>
      <div class="stat-value">${s.val}</div>
    </div>`).join('');
  el('today-apts-list').innerHTML=todayA.length?`<div style="overflow-x:auto"><table class="appointment-table"><thead><tr><th>MÃ¼ÅŸteri</th><th>Berber</th><th>Hizmet</th><th>Saat</th><th>Durum</th><th>Ä°ÅŸlem</th></tr></thead><tbody>${todayA.map(aptRow).join('')}</tbody></table></div>`:emptyState('ğŸ“…','BugÃ¼n iÃ§in randevu bulunmuyor.');
}

function aptRow(a){
  return`<tr>
    <td><strong>${a.custName}</strong><br><span style="color:var(--gray);font-size:.78rem">${a.custPhone}</span></td>
    <td>${barberName(a.barberId)}</td><td>${serviceName(a.serviceId)}</td>
    <td><strong>${a.time}</strong><br><span style="font-size:.78rem;color:var(--gray)">${a.date}</span></td>
    <td>${statusBadge(a.status)}</td>
    <td><div style="display:flex;gap:4px;flex-wrap:wrap">
      ${a.status==='Bekliyor'?`<button class="btn btn-success btn-sm" onclick="setAptStatus(${a.id},'OnaylandÄ±')">Onayla</button><button class="btn btn-danger btn-sm" onclick="setAptStatus(${a.id},'Reddedildi')">Reddet</button>`:''}
      ${a.status!=='Ä°ptal'&&a.status!=='Reddedildi'?`<button class="btn btn-warning btn-sm" onclick="setAptStatus(${a.id},'Ä°ptal')">Ä°ptal</button>`:''}
    </div></td>
  </tr>`;
}

function setAptStatus(id,status){
  const apts=DB.get('apts')||[];
  const a=apts.find(a=>a.id===id);if(a)a.status=status;DB.set('apts',apts);
  renderDashboard();if(calViewType==='list')renderListView();else renderCalendar();
  closeModal('modal-day');
}

function emptyState(icon,txt){return`<div class="empty-state"><div class="empty-state-icon">${icon}</div><div>${txt}</div></div>`}

// â”€ Calendar â”€
function switchCalView(v){
  calViewType=v;
  el('tab-calendar-btn').classList.toggle('active',v==='calendar');
  el('tab-list-btn').classList.toggle('active',v==='list');
  if(v==='calendar'){show('calendar-view-wrap');hide('list-view-wrap');renderCalendar()}
  else{hide('calendar-view-wrap');show('list-view-wrap');renderListView()}
}
function setFilter(f,btn){
  calFilter=f;
  document.querySelectorAll('.filter-chip').forEach(c=>c.classList.remove('active'));
  btn.classList.add('active');
  renderCalendar();renderListView();
}
function prevMonth(){calDate.setMonth(calDate.getMonth()-1);renderCalendar()}
function nextMonth(){calDate.setMonth(calDate.getMonth()+1);renderCalendar()}

function renderCalendar(){
  const yr=calDate.getFullYear(),mo=calDate.getMonth();
  const mns=['Ocak','Åubat','Mart','Nisan','MayÄ±s','Haziran','Temmuz','AÄŸustos','EylÃ¼l','Ekim','KasÄ±m','AralÄ±k'];
  const dns=['Pzt','Sal','Ã‡ar','Per','Cum','Cmt','Paz'];
  el('cal-month-label').textContent=`${mns[mo]} ${yr}`;
  el('cal-headers').innerHTML=dns.map(d=>`<div class="calendar-header-cell">${d}</div>`).join('');
  const first=new Date(yr,mo,1);
  let sd=first.getDay()-1;if(sd<0)sd=6;
  const dim=new Date(yr,mo+1,0).getDate(),dip=new Date(yr,mo,0).getDate();
  const apts=DB.get('apts')||[];const td=today();
  let html='';
  for(let i=sd-1;i>=0;i--)html+=`<div class="calendar-day other-month"><div class="day-num">${dip-i}</div></div>`;
  for(let d=1;d<=dim;d++){
    const ds=`${yr}-${String(mo+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    let da=apts.filter(a=>a.date===ds);
    if(calFilter!=='all')da=da.filter(a=>a.status===calFilter);
    const isT=ds===td;
    const dots=da.slice(0,5).map(a=>{const m={Bekliyor:'pending',OnaylandÄ±:'approved',Reddedildi:'rejected',Ä°ptal:'cancelled'};return`<div class="apt-dot dot-${m[a.status]||'pending'}"></div>`}).join('');
    html+=`<div class="calendar-day${isT?' today':''}${da.length?' has-appointments':''}" onclick="showDayModal('${ds}')">
      <div class="day-num">${d}</div>${dots?`<div class="apt-dots">${dots}</div>`:''}
    </div>`;
  }
  el('cal-days').innerHTML=html;
}

function showDayModal(ds){
  let da=(DB.get('apts')||[]).filter(a=>a.date===ds);
  if(calFilter!=='all')da=da.filter(a=>a.status===calFilter);
  el('modal-day-title').textContent=formatDate(ds)+' â€” Randevular';
  el('modal-day-body').innerHTML=da.length?da.map(a=>`
    <div style="border:1px solid #f0f0f0;border-radius:12px;padding:16px;margin-bottom:12px">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px">
        <div><div style="font-weight:700">${a.custName}</div><div style="font-size:.8rem;color:var(--gray)">${a.custPhone}</div></div>
        <div style="text-align:right">${statusBadge(a.status)}<div style="font-size:.9rem;font-weight:700;margin-top:4px">${a.time}</div></div>
      </div>
      <div style="font-size:.85rem;color:var(--gray);margin-bottom:12px">âœ‚ ${barberName(a.barberId)} Â· ${serviceName(a.serviceId)}</div>
      <div style="display:flex;gap:6px;flex-wrap:wrap">
        ${a.status==='Bekliyor'?`<button class="btn btn-success btn-sm" onclick="setAptStatus(${a.id},'OnaylandÄ±')">Onayla</button><button class="btn btn-danger btn-sm" onclick="setAptStatus(${a.id},'Reddedildi')">Reddet</button>`:''}
        ${a.status!=='Ä°ptal'&&a.status!=='Reddedildi'?`<button class="btn btn-warning btn-sm" onclick="setAptStatus(${a.id},'Ä°ptal')">Ä°ptal</button>`:''}
      </div>
    </div>`).join(''):emptyState('ğŸ“…','Bu gÃ¼n iÃ§in randevu yok.');
  show('modal-day');
}

function renderListView(){
  const apts=DB.get('apts')||[];
  let fa=calFilter==='all'?apts:apts.filter(a=>a.status===calFilter);
  fa=fa.sort((a,b)=>(a.date+a.time).localeCompare(b.date+b.time));
  el('apt-list-tbody').innerHTML=fa.length?fa.map(aptRow).join(''):`<tr><td colspan="6">${emptyState('ğŸ“‹','Randevu bulunamadÄ±.')}</td></tr>`;
}

// â”€ Barbers â”€
function renderBarbers(){
  const bs=DB.get('barbers')||[];
  el('barber-list').innerHTML=bs.length?bs.map(b=>`
    <div class="barber-card">
      <div class="barber-avatar">${b.name.charAt(0)}</div>
      <div class="barber-info"><div class="barber-name">${b.name}</div><div class="barber-status">${b.active?'ğŸŸ¢ Aktif':'ğŸ”´ Pasif'}</div></div>
      <div style="display:flex;align-items:center;gap:12px">
        <label class="toggle"><input type="checkbox" ${b.active?'checked':''} onchange="toggleBarber(${b.id},this.checked)"><span class="toggle-slider"></span></label>
        <button class="btn btn-danger btn-sm" onclick="deleteBarber(${b.id})">Sil</button>
      </div>
    </div>`).join(''):emptyState('âœ‚','Berber bulunamadÄ±.');
}
function addBarber(){
  const n=el('new-barber-name').value.trim();if(!n)return;
  const bs=DB.get('barbers')||[];bs.push({id:Date.now(),name:n,active:true});DB.set('barbers',bs);
  el('new-barber-name').value='';renderBarbers();
}
function toggleBarber(id,v){
  const bs=DB.get('barbers')||[];const b=bs.find(b=>b.id===id);if(b){b.active=v;DB.set('barbers',bs);}renderBarbers();
}
function deleteBarber(id){
  if(!confirm('Bu berberi silmek istediÄŸinize emin misiniz?'))return;
  DB.set('barbers',(DB.get('barbers')||[]).filter(b=>b.id!==id));renderBarbers();
}

// â”€ Services â”€
function renderServices(){
  const svcs=DB.get('services')||[];
  el('service-list').innerHTML=svcs.length?svcs.map(s=>`
    <div class="service-row">
      <div class="service-info"><div class="service-name">${s.name}</div><div class="service-meta">â± ${s.duration} dakika</div></div>
      <div class="service-price">${s.price}â‚º</div>
      <div style="display:flex;gap:6px">
        <button class="btn btn-ghost btn-sm" onclick="openEditSvc(${s.id})">DÃ¼zenle</button>
        <button class="btn btn-danger btn-sm" onclick="deleteSvc(${s.id})">Sil</button>
      </div>
    </div>`).join(''):emptyState('ğŸ“‹','Hizmet bulunamadÄ±.');
}
function addService(){
  const n=el('new-svc-name').value.trim(),p=parseInt(el('new-svc-price').value),d=parseInt(el('new-svc-dur').value);
  if(!n||!p||!d){alert('TÃ¼m alanlarÄ± doldurun.');return;}
  const svcs=DB.get('services')||[];svcs.push({id:Date.now(),name:n,price:p,duration:d});DB.set('services',svcs);
  el('new-svc-name').value='';el('new-svc-price').value='';el('new-svc-dur').value='';renderServices();
}
function openEditSvc(id){
  editSvcId=id;const s=(DB.get('services')||[]).find(s=>s.id===id);if(!s)return;
  el('edit-svc-name').value=s.name;el('edit-svc-price').value=s.price;el('edit-svc-dur').value=s.duration;
  show('modal-edit-svc');
}
function saveEditSvc(){
  const svcs=DB.get('services')||[];const s=svcs.find(s=>s.id===editSvcId);
  if(s){s.name=el('edit-svc-name').value.trim();s.price=parseInt(el('edit-svc-price').value);s.duration=parseInt(el('edit-svc-dur').value);DB.set('services',svcs);}
  closeModal('modal-edit-svc');renderServices();
}
function deleteSvc(id){
  if(!confirm('Bu hizmeti silmek istediÄŸinize emin misiniz?'))return;
  DB.set('services',(DB.get('services')||[]).filter(s=>s.id!==id));renderServices();
}

// â”€ Hours â”€
function renderHours(){
  const h=DB.get('hours')||{};
  const days=['Pazartesi','SalÄ±','Ã‡arÅŸamba','PerÅŸembe','Cuma','Cumartesi','Pazar'];
  el('hours-grid').innerHTML=days.map(day=>{
    const dh=h[day]||{open:'09:00',close:'20:00',closed:false};
    return`<div class="day-card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
        <div class="day-name">${day}</div>
        <label class="toggle"><input type="checkbox" ${dh.closed?'':'checked'} onchange="setDayClosed('${day}',!this.checked)"><span class="toggle-slider"></span></label>
      </div>
      ${dh.closed?'<div style="text-align:center;color:var(--danger);font-size:.8rem;font-weight:600">KapalÄ±</div>':`
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
        <div class="input-group"><label class="label" style="font-size:.75rem">AÃ§Ä±lÄ±ÅŸ</label><input class="input" type="time" value="${dh.open}" onchange="updateHours('${day}','open',this.value)" style="padding:8px 10px;font-size:.85rem"></div>
        <div class="input-group"><label class="label" style="font-size:.75rem">KapanÄ±ÅŸ</label><input class="input" type="time" value="${dh.close}" onchange="updateHours('${day}','close',this.value)" style="padding:8px 10px;font-size:.85rem"></div>
      </div>`}
    </div>`;
  }).join('');
  renderHolidays();
}
function updateHours(day,f,v){const h=DB.get('hours')||{};if(!h[day])h[day]={};h[day][f]=v;DB.set('hours',h)}
function setDayClosed(day,cl){const h=DB.get('hours')||{};if(!h[day])h[day]={};h[day].closed=cl;DB.set('hours',h);renderHours()}
function renderHolidays(){
  const hols=DB.get('holidays')||[];
  el('holiday-list').innerHTML=hols.length?hols.map(h=>`
    <div style="display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:var(--gray-light);border-radius:10px;margin-bottom:8px">
      <div><div style="font-weight:700">${formatDate(h.date)}</div>${h.note?`<div style="font-size:.8rem;color:var(--gray)">${h.note}</div>`:''}</div>
      <button class="btn btn-danger btn-sm" onclick="removeHoliday('${h.date}')">Sil</button>
    </div>`).join(''):'<div style="color:var(--gray);font-size:.9rem">Tatil gÃ¼nÃ¼ eklenmemiÅŸ.</div>';
}
function addHoliday(){
  const d=el('holiday-date').value,n=el('holiday-note').value.trim();if(!d)return;
  const hols=DB.get('holidays')||[];
  if(!hols.find(h=>h.date===d))hols.push({date:d,note:n});DB.set('holidays',hols);
  el('holiday-date').value='';el('holiday-note').value='';renderHolidays();
}
function removeHoliday(d){DB.set('holidays',(DB.get('holidays')||[]).filter(h=>h.date!==d));renderHolidays()}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CUSTOMER
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadLoginBarbers(){
  const barbers=(DB.get('barbers')||[]).filter(b=>b.active);
  const container=el('login-barbers');
  if(!container)return;
  container.innerHTML=barbers.length?barbers.map(b=>
    `<div style="background:rgba(255,255,255,.1);padding:6px 14px;border-radius:8px;font-size:.8rem;color:rgba(255,255,255,.7)">âœ‚ ${b.name}</div>`
  ).join(''):'<div style="color:rgba(255,255,255,.5);font-size:.8rem">HenÃ¼z berber eklenmemiÅŸ</div>';
}

function customerLogin(){
  const n=el('cust-name').value.trim(),s=el('cust-surname').value.trim(),p=el('cust-phone').value.trim();
  if(!n||!s||!p){show('cust-login-error');return}
  hide('cust-login-error');
  custSession={name:n,surname:s,phone:p,fullName:n+' '+s};
  DB.set('custSession',custSession);
  // Save quick-login profile
  const profiles=DB.get('profiles')||{};
  profiles[p]={name:n,surname:s,phone:p};
  DB.set('profiles',profiles);
  show('customer-dashboard');hide('customer-login');initCustomer();
}
function customerLogout(){
  DB.set('custSession',null);custSession=null;selService=null;selTime=null;
  show('customer-login');hide('customer-dashboard');loadLoginBarbers();
}
function initCustomer(){
  el('cust-header-name').textContent=custSession.fullName;
  el('cust-header-phone').textContent=custSession.phone;
  el('cust-avatar').textContent=custSession.name.charAt(0)+custSession.surname.charAt(0);
  buildBookingForm();showCustTab('book');
}
function showCustTab(tab){
  ['book','myapts','qrcard'].forEach(t=>hide('cust-tab-'+t));
  show('cust-tab-'+tab);
  ['book','myapts','qrcard'].forEach(t=>{
    const nb=el('nav-'+t);if(nb)nb.classList.toggle('active',t===tab);
  });
  if(tab==='myapts')renderMyApts();
  if(tab==='qrcard')renderCustQR();
}

function renderCustQR(){
  if(!custSession)return;
  el('qrcard-name').textContent=custSession.fullName;
  el('qrcard-phone').textContent=custSession.phone;
  const container=el('cust-qr-container');
  if(!container)return;
  container.innerHTML='';
  const qrData=JSON.stringify({name:custSession.name,surname:custSession.surname,phone:custSession.phone,source:'barberx-qr'});
  if(window.QRCode){
    new QRCode(container,{text:qrData,width:160,height:160,colorDark:'#0a0a0a',colorLight:'#ffffff',correctLevel:QRCode.CorrectLevel.M});
  } else {
    container.innerHTML='<div style="text-align:center;color:#888;font-size:.8rem;padding:20px">QR yÃ¼kleniyor...</div>';
    setTimeout(renderCustQR,500);
  }
}

// â”€ Booking form â”€
function buildBookingForm(){
  const bs=(DB.get('barbers')||[]).filter(b=>b.active);
  el('book-barber').innerHTML='<option value="">â€” Berber seÃ§in â€”</option>'+bs.map(b=>`<option value="${b.id}">${b.name}</option>`).join('');
  const svcs=DB.get('services')||[];
  el('book-services').innerHTML=svcs.map(s=>`
    <div class="service-option" id="so-${s.id}" onclick="pickService(${s.id})">
      <div class="so-name">${s.name}</div><div class="so-price">${s.price}â‚º</div><div class="so-meta">â± ${s.duration} dakika</div>
    </div>`).join('');
  const td=today();el('book-date').min=td;el('book-date').value=td;
  el('book-times').innerHTML='';selService=null;selTime=null;updateSteps();updateSummary();
}
function onBarberChange(){loadSlots();updateSummary()}
function pickService(id){
  selService=id;selTime=null;
  document.querySelectorAll('.service-option').forEach(e=>e.classList.remove('selected'));
  el('so-'+id)?.classList.add('selected');
  loadSlots();updateSteps();updateSummary();
}
function loadSlots(){
  const date=el('book-date').value,barberId=parseInt(el('book-barber').value);if(!date)return;
  const hols=DB.get('holidays')||[];
  if(hols.find(h=>h.date===date)){el('book-times').innerHTML=`<div style="grid-column:1/-1;color:var(--danger);font-size:.85rem;font-weight:600">â›” Bu gÃ¼n tatil â€” randevu alÄ±namaz.</div>`;return}
  const hrs=DB.get('hours')||{};
  const dns=['Pazar','Pazartesi','SalÄ±','Ã‡arÅŸamba','PerÅŸembe','Cuma','Cumartesi'];
  const dayName=dns[new Date(date).getDay()];
  const dh=hrs[dayName]||{open:'09:00',close:'20:00',closed:false};
  if(dh.closed){el('book-times').innerHTML=`<div style="grid-column:1/-1;color:var(--danger);font-size:.85rem;font-weight:600">â›” ${dayName} gÃ¼nÃ¼ kapalÄ±.</div>`;return}
  const svc=selService?(DB.get('services')||[]).find(s=>s.id===selService):null;
  const dur=svc?svc.duration:30;
  const taken=new Set((DB.get('apts')||[]).filter(a=>a.date===date&&a.barberId===barberId&&a.status!=='Ä°ptal'&&a.status!=='Reddedildi').map(a=>a.time));
  const slots=genSlots(dh.open,dh.close,dur);
  const now=new Date(),isTd=date===today();
  el('book-times').innerHTML=slots.map(t=>{
    const[h,m]=t.split(':').map(Number);
    const dis=taken.has(t)||(isTd&&(h<now.getHours()||(h===now.getHours()&&m<=now.getMinutes())));
    const sel=selTime===t;
    return`<div class="time-slot${dis?' disabled':''}${sel?' selected':''}" ${dis?'':'onclick="pickTime(\''+t+'\')"'}>${t}</div>`;
  }).join('');
  updateSteps();
}
function pickTime(t){selTime=t;loadSlots();updateSummary();updateSteps()}
function updateSteps(){
  const bid=el('book-barber').value,date=el('book-date').value;
  const s1=!!bid,s2=s1&&!!selService,s3=s2&&!!date&&!!selTime;
  const setS=(n,done,active)=>{
    el('step-'+n).classList.toggle('done',done);
    el('step-'+n).classList.toggle('active',active&&!done);
  };
  setS(1,s1,!s1);setS(2,s2,s1&&!selService);setS(3,s3,s2&&!selTime);setS(4,false,s3);
}
function updateSummary(){
  const bid=parseInt(el('book-barber').value);
  const b=(DB.get('barbers')||[]).find(x=>x.id===bid);
  const svc=selService?(DB.get('services')||[]).find(s=>s.id===selService):null;
  el('booking-summary').innerHTML=`<div style="display:grid;gap:10px">
    <div style="display:flex;justify-content:space-between"><span style="color:var(--gray)">Berber</span><strong>${b?.name||'â€”'}</strong></div>
    <div style="display:flex;justify-content:space-between"><span style="color:var(--gray)">Hizmet</span><strong>${svc?.name||'â€”'}</strong></div>
    <div style="display:flex;justify-content:space-between"><span style="color:var(--gray)">Fiyat</span><strong style="color:var(--gold)">${svc?svc.price+'â‚º':'â€”'}</strong></div>
    <div style="display:flex;justify-content:space-between"><span style="color:var(--gray)">Tarih</span><strong>${el('book-date').value?formatDate(el('book-date').value):'â€”'}</strong></div>
    <div style="display:flex;justify-content:space-between"><span style="color:var(--gray)">Saat</span><strong>${selTime||'â€”'}</strong></div>
    <div class="gold-line" style="margin:4px 0"></div>
    <div style="display:flex;justify-content:space-between"><span style="color:var(--gray)">MÃ¼ÅŸteri</span><strong>${custSession?.fullName||'â€”'}</strong></div>
  </div>`;
}
function createAppointment(){
  const bid=el('book-barber').value,date=el('book-date').value;
  if(!bid||!selService||!date||!selTime){alert('LÃ¼tfen tÃ¼m alanlarÄ± doldurun.');return}
  const apts=DB.get('apts')||[];
  apts.push({id:Date.now(),custName:custSession.fullName,custPhone:custSession.phone,barberId:parseInt(bid),serviceId:selService,date,time:selTime,status:'Bekliyor',ts:Date.now()});
  DB.set('apts',apts);selService=null;selTime=null;
  show('booking-success');setTimeout(()=>hide('booking-success'),4000);
  buildBookingForm();
}

// â”€ My Apts â”€
function filterMyApts(f,btn){
  myFilter=f;
  document.querySelectorAll('#cust-tab-myapts .view-tab').forEach(t=>t.classList.remove('active'));
  btn.classList.add('active');renderMyApts();
}
function renderMyApts(){
  if(!custSession)return;
  const td=today();
  let mine=(DB.get('apts')||[]).filter(a=>a.custPhone===custSession.phone);
  if(myFilter==='upcoming')mine=mine.filter(a=>a.date>=td&&a.status!=='Ä°ptal'&&a.status!=='Reddedildi');
  else mine=mine.filter(a=>a.date<td||a.status==='Ä°ptal'||a.status==='Reddedildi');
  mine.sort((a,b)=>(a.date+a.time).localeCompare(b.date+b.time));
  el('my-apts-list').innerHTML=mine.length?mine.map(a=>{
    const svc=(DB.get('services')||[]).find(s=>s.id===a.serviceId);
    return`<div class="my-apt-card">
      <div class="my-apt-header"><div class="my-apt-date">ğŸ“… ${formatDate(a.date)} â€” ${a.time}</div>${statusBadge(a.status)}</div>
      <div class="my-apt-body">
        <div class="my-apt-detail"><span class="my-apt-icon">âœ‚</span><span>${barberName(a.barberId)}</span></div>
        <div class="my-apt-detail"><span class="my-apt-icon">ğŸ“‹</span><span>${svc?.name||'â€”'} Â· ${svc?.duration||'?'} dk</span></div>
        <div class="my-apt-detail"><span class="my-apt-icon">ğŸ’°</span><span style="color:var(--gold);font-weight:700">${svc?svc.price+'â‚º':'â€”'}</span></div>
      </div>
      ${(a.status==='Bekliyor'||a.status==='OnaylandÄ±')?`<div class="my-apt-actions">
        <button class="btn btn-ghost btn-sm" onclick="openEditApt(${a.id})">âœ DÃ¼zenle</button>
        <button class="btn btn-danger btn-sm" onclick="cancelApt(${a.id})">âœ• Ä°ptal Et</button>
      </div>`:''}
    </div>`;
  }).join(''):emptyState('ğŸ“…',myFilter==='upcoming'?'YaklaÅŸan randevunuz bulunmuyor.':'GeÃ§miÅŸ randevunuz bulunmuyor.');
}
function cancelApt(id){
  if(!confirm('Randevuyu iptal etmek istediÄŸinize emin misiniz?'))return;
  const apts=DB.get('apts')||[];const a=apts.find(a=>a.id===id);
  if(a){a.status='Ä°ptal';DB.set('apts',apts)}renderMyApts();
}
function openEditApt(id){
  editAptId=id;const a=(DB.get('apts')||[]).find(a=>a.id===id);if(!a)return;
  const bs=(DB.get('barbers')||[]).filter(b=>b.active),svcs=DB.get('services')||[];
  el('edit-barber').innerHTML=bs.map(b=>`<option value="${b.id}"${b.id===a.barberId?' selected':''}>${b.name}</option>`).join('');
  el('edit-service').innerHTML=svcs.map(s=>`<option value="${s.id}"${s.id===a.serviceId?' selected':''}>${s.name} â€” ${s.price}â‚º</option>`).join('');
  el('edit-date').min=today();el('edit-date').value=a.date;
  loadEditSlots(a.time);show('modal-edit-apt');
}
function loadEditSlots(preselect){
  const date=el('edit-date').value;if(!date)return;
  const hrs=DB.get('hours')||{};
  const dns=['Pazar','Pazartesi','SalÄ±','Ã‡arÅŸamba','PerÅŸembe','Cuma','Cumartesi'];
  const dh=hrs[dns[new Date(date).getDay()]]||{open:'09:00',close:'20:00'};
  const slots=genSlots(dh.open,dh.close,30);
  el('edit-time').innerHTML=slots.map(t=>`<option value="${t}"${t===(preselect||el('edit-time').value)?' selected':''}>${t}</option>`).join('');
}
function saveEditApt(){
  const apts=DB.get('apts')||[];const a=apts.find(a=>a.id===editAptId);
  if(a){a.barberId=parseInt(el('edit-barber').value);a.serviceId=parseInt(el('edit-service').value);a.date=el('edit-date').value;a.time=el('edit-time').value;a.status='Bekliyor';DB.set('apts',apts)}
  closeModal('modal-edit-apt');renderMyApts();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// TV PANEL
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let tvTimer=null,tvClockTimer=null;

// Sound notification system
let lastAptCount=0;
let audioContext=null;

function initAudio(){
  if(!audioContext){
    try{
      audioContext=new(window.AudioContext||window.webkitAudioContext)();
    }catch(e){console.log('Audio not available');}
  }
}

function playNewAptSound(){
  if(!audioContext)initAudio();
  if(!audioContext)return;
  
  // Create pleasant notification chime (C-E-G chord)
  const now=audioContext.currentTime;
  const notes=[261.63,329.63,392.00]; // C4, E4, G4
  
  notes.forEach((freq,i)=>{
    const osc=audioContext.createOscillator();
    const gain=audioContext.createGain();
    osc.connect(gain);
    gain.connect(audioContext.destination);
    
    osc.frequency.value=freq;
    osc.type='sine';
    
    const startTime=now+i*0.15;
    gain.gain.setValueAtTime(0,startTime);
    gain.gain.linearRampToValueAtTime(0.15,startTime+0.05);
    gain.gain.exponentialRampToValueAtTime(0.01,startTime+0.8);
    
    osc.start(startTime);
    osc.stop(startTime+0.8);
  });
}
let tvPrevAptIds=new Set();
let tvCountdownTimer=null;

function startTV(){
  renderTV();updateTVClock();generateQR();
  if(tvTimer)clearInterval(tvTimer);
  if(tvClockTimer)clearInterval(tvClockTimer);
  tvTimer=setInterval(renderTV,10000);
  tvClockTimer=setInterval(updateTVClock,1000);
  startCountdown();
}

function updateTVClock(){
  const n=new Date();
  el('tv-clock').textContent=n.toLocaleTimeString('tr-TR',{hour:'2-digit',minute:'2-digit'});
  el('tv-date-str').textContent=n.toLocaleDateString('tr-TR',{weekday:'long',year:'numeric',month:'long',day:'numeric'});
}

function startCountdown(){
  if(tvCountdownTimer)clearInterval(tvCountdownTimer);
  tvCountdownTimer=setInterval(updateCountdown,1000);
  updateCountdown();
}

function updateCountdown(){
  const td=today();
  const now=new Date();
  const approved=(DB.get('apts')||[]).filter(a=>a.date===td&&a.status==='OnaylandÄ±').sort((a,b)=>a.time.localeCompare(b.time));
  const nowMins=now.getHours()*60+now.getMinutes();
  const next=approved.find(a=>{const[h,m]=a.time.split(':').map(Number);return h*60+m>nowMins});
  const bar=el('tv-stats-bar');if(!bar)return;
  const cdEl=document.getElementById('tv-cd-wrap');
  if(next){
    const[h,m]=next.time.split(':').map(Number);
    const diff=(h*60+m)-nowMins;
    const hrs=Math.floor(diff/60),mins=diff%60;
    const txt=hrs>0?`${hrs}s ${mins}d`:`${mins} dk`;
    if(cdEl){
      document.getElementById('tv-cd-name').textContent=next.custName;
      document.getElementById('tv-cd-val').textContent=txt;
      document.getElementById('tv-cd-time').textContent=next.time;
    }
  } else if(cdEl){
    document.getElementById('tv-cd-val').textContent='â€”';
  }
}


// Calculate estimated wait time for an appointment
function calculateWaitTime(aptTime,barberApts,nowMins){
  const[h,m]=aptTime.split(':').map(Number);
  const aptMins=h*60+m;
  if(aptMins<=nowMins)return 0; // Already started or passed
  // Sum durations of all appointments before this one today
  let totalWait=0;
  const svcs=DB.get('services')||[];
  for(const ba of barberApts){
    const[bh,bm]=ba.time.split(':').map(Number);
    const bMins=bh*60+bm;
    if(bMins<aptMins){
      const svc=svcs.find(s=>s.id===ba.serviceId);
      totalWait+=(svc?svc.duration:30);
    }
  }
  // Add buffer time between appointments (5 mins)
  const numBefore=barberApts.filter(ba=>{const[bh,bm]=ba.time.split(':').map(Number);return bh*60+bm<aptMins}).length;
  totalWait+=numBefore*5;
  return Math.max(0,totalWait-(aptMins-nowMins));
}
function renderTV(){
  const td=today();
  const allApts=(DB.get('apts')||[]).filter(a=>a.date===td).sort((a,b)=>a.time.localeCompare(b.time));
  const approved=allApts.filter(a=>a.status==='OnaylandÄ±');
  const cancelled=allApts.filter(a=>a.status==='Ä°ptal');
  const barbers=(DB.get('barbers')||[]).filter(b=>b.active);

  // Stats
  const total=allApts.filter(a=>a.status!=='Ä°ptal'&&a.status!=='Reddedildi').length;
  const done=approved.length;
  const waiting=allApts.filter(a=>a.status==='Bekliyor').length;
  const now=new Date();const nowMins=now.getHours()*60+now.getMinutes();
  const nextApt=approved.find(a=>{const[h,m]=a.time.split(':').map(Number);return h*60+m>nowMins});

  el('tv-stats-bar').innerHTML=`
    <div class="tv-stat"><div class="tv-stat-num">${total}</div><div class="tv-stat-lbl">Toplam<br>Randevu</div></div>
    <div class="tv-stat"><div class="tv-stat-num" style="color:#6ee7b7">${done}</div><div class="tv-stat-lbl">Onaylanan<br>Randevu</div></div>
    <div class="tv-stat"><div class="tv-stat-num" style="color:#fcd34d">${waiting}</div><div class="tv-stat-lbl">Onay<br>Bekleyen</div></div>
    ${nextApt?`<div class="tv-countdown" id="tv-cd-wrap">
      <div>
        <div class="tv-countdown-lbl">SÄ±radaki: <span style="color:var(--white);font-weight:700" id="tv-cd-name">${nextApt.custName}</span> <span style="opacity:.6" id="tv-cd-time">(${nextApt.time})</span></div>
        <div class="tv-countdown-val" id="tv-cd-val">...</div>
      </div>
    </div>`:''}
  `;
  updateCountdown();

  // New arrivals = approved apts added since last render
  const currentIds=new Set(approved.map(a=>a.id));
  const newIds=new Set([...currentIds].filter(id=>!tvPrevAptIds.has(id)));
  
  // Play sound for new appointments
  if(newIds.size>0&&tvPrevAptIds.size>0){
    playNewAptSound();
  }
  
  tvPrevAptIds=currentIds;

  // Barber columns
  const cols=barbers.map(b=>{
    const bApts=approved.filter(a=>a.barberId===b.id);
    const cards=bApts.length?bApts.map(a=>{
      const isNew=newIds.has(a.id);
      const svc=(DB.get('services')||[]).find(s=>s.id===a.serviceId);
      const waitMins=calculateWaitTime(a.time,bApts,nowMins);
      const isNext=nextApt&&a.id===nextApt.id;
      return`<div class="tv-apt-card status-approved${isNew?' new-arrival':''}${isNext?' tv-next-card':''}">
        ${isNext?'<div class="tv-next-label">â­ ÅÄ°MDÄ° SIRA</div>':''}
        <div class="tv-apt-time">${a.time}${isNew?'<span class="tv-new-badge">YENÄ°</span>':''}</div>
        <div class="tv-apt-name">${a.custName}</div>
        <div class="tv-apt-service">${serviceName(a.serviceId)}${svc?' Â· '+svc.duration+' dk':''}</div>
        <div style="display:flex;gap:6px;flex-wrap:wrap;align-items:center">
          <span class="tv-status-badge approved">âœ… OnaylandÄ±</span>
          ${waitMins>0?`<span class="tv-wait-badge">â± ~${waitMins} dk</span>`:'<span class="tv-wait-badge" style="background:rgba(34,197,94,.2);color:#86efac">â–¶ Åimdi</span>'}
        </div>
      </div>`;
    }).join(''):`<div class="tv-empty-col">Randevu yok</div>`;
    return`<div class="tv-barber-col">
      <div class="tv-barber-col-header">
        <div class="tv-barber-col-avatar">${b.name.charAt(0)}</div>
        <div><div class="tv-barber-col-name">${b.name}</div><div class="tv-barber-col-count">${bApts.length} randevu</div></div>
      </div>
      ${cards}
    </div>`;
  });

  // Dynamic columns count
  const colCount=Math.min(barbers.length,3);
  const colsEl=el('tv-barber-cols');
  colsEl.style.gridTemplateColumns=`repeat(${colCount},1fr)`;
  colsEl.innerHTML=approved.length||barbers.length?cols.join(''):`<div style="grid-column:1/-1;text-align:center;padding:60px 0;color:rgba(255,255,255,.25);font-size:1.1rem">ğŸ“… BugÃ¼n iÃ§in onaylanan randevu bulunmuyor.</div>`;

  // Hide cancelled bar entirely - not shown on TV
  const cbar=el('tv-cancelled-bar');
  if(cbar)cbar.classList.remove('has-cancelled');

  // Marquee
  const names=approved.map(a=>a.custName);
  el('tv-marquee').textContent=names.length?names.map(n=>`HoÅŸ geldiniz, ${n}!`).join('  Â·  ')+'  Â·  BarberX â€” Profesyonel Berber Randevu Sistemi':'BarberX â€” Profesyonel Berber Randevu Sistemi  Â·  SaÃ§ Kesimi Â· Sakal TÄ±raÅŸÄ± Â· Ã‡ocuk Kesimi';
}

// Notification sound (placeholder - could add actual audio file)

// â”€â”€ QR Code Generator (vanilla canvas, no library) â”€â”€
function generateQR(){
  const cvs=el('tv-qr-canvas');if(!cvs)return;
  const url=location.origin+location.pathname;
  el('tv-qr-url').textContent=url;
  // Draw simple QR-style placeholder with URL encoded as pattern
  // Use a micro QR library polyfill via data URL approach
  drawSimpleQR(cvs,url);
}

function drawSimpleQR(canvas,text){
  // Generate QR using qrcodejs loaded inline
  canvas.width=78;canvas.height=78;
  const ctx=canvas.getContext('2d');
  // Simple visual placeholder that resembles QR
  ctx.fillStyle='#ffffff';ctx.fillRect(0,0,78,78);
  // We'll use the qrcode script loaded below
  if(window.QRCode){
    canvas.innerHTML='';
    const div=document.createElement('div');
    new QRCode(div,{text,width:78,height:78,colorDark:'#000',colorLight:'#fff',correctLevel:QRCode.CorrectLevel.M});
    setTimeout(()=>{
      const img=div.querySelector('img')||div.querySelector('canvas');
      if(img){
        if(img.tagName==='IMG'){
          const i=new Image();i.onload=()=>{ctx.drawImage(i,0,0,78,78)};i.src=img.src;
        } else {
          ctx.drawImage(img,0,0,78,78);
        }
      }
    },200);
  } else {
    // Fallback: draw BarberX text QR style
    ctx.fillStyle='#000';
    ctx.font='bold 7px monospace';
    ctx.fillText('BarberX',8,40);
    ctx.fillText('QR',22,52);
    // Draw corner squares
    [[2,2],[2,52],[52,2]].forEach(([x,y])=>{
      ctx.fillRect(x,y,22,22);ctx.fillStyle='#fff';ctx.fillRect(x+3,y+3,16,16);
      ctx.fillStyle='#000';ctx.fillRect(x+6,y+6,10,10);ctx.fillStyle='#000';
    });
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// MODAL CLICK OUTSIDE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.querySelectorAll('.modal-overlay').forEach(o=>{
  o.addEventListener('click',e=>{if(e.target===o)o.classList.add('hidden')});
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
// Re-generate QR after library loads
window.addEventListener('load',()=>{
  setTimeout(()=>{
    if(location.hash==='#/display'){
      const cvs=document.getElementById('tv-qr-canvas');
      if(cvs&&window.QRCode){
        const url=location.origin+location.pathname+'#/';
        document.getElementById('tv-qr-url').textContent=url;
        cvs.parentElement.innerHTML='';
        const div=document.createElement('div');
        cvs.parentElement.appendChild(div);
        new QRCode(div,{text:url,width:78,height:78,colorDark:'#000000',colorLight:'#ffffff',correctLevel:QRCode.CorrectLevel.M});
      }
    }
  },600);
});
</script>
</body>
</html>
